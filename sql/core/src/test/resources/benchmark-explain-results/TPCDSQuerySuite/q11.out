TakeOrderedAndProject(limit=100, orderBy=[customer_preferred_cust_flag#0 ASC NULLS FIRST], output=[customer_preferred_cust_flag#0])
+- *Project [customer_preferred_cust_flag#0]
   +- *BroadcastHashJoin [customer_id#0], [customer_id#0], Inner, BuildRight, (CASE WHEN (year_total#0 > 0.00) THEN CheckOverflow((promote_precision(year_total#0) / promote_precision(year_total#0)), DecimalType(38,20)) ELSE null END > CASE WHEN (year_total#0 > 0.00) THEN CheckOverflow((promote_precision(year_total#0) / promote_precision(year_total#0)), DecimalType(38,20)) ELSE null END)
      :- *Project [customer_id#0, year_total#0, year_total#0, year_total#0, customer_preferred_cust_flag#0]
      :  +- *BroadcastHashJoin [customer_id#0], [customer_id#0], Inner, BuildRight
      :     :- *Project [customer_id#0, year_total#0, year_total#0, customer_preferred_cust_flag#0]
      :     :  +- *BroadcastHashJoin [customer_id#0], [customer_id#0], Inner, BuildRight
      :     :     :- Union
      :     :     :  :- *Filter (isnotnull(year_total#0) && (0.00 < year_total#0))
      :     :     :  :  +- *HashAggregate(keys=[c_customer_id#0, c_first_name#0, c_last_name#0, d_year#0, c_preferred_cust_flag#0, c_birth_country#0, c_login#0, c_email_address#0], functions=[sum(UnscaledValue(CheckOverflow((promote_precision(cast(ss_ext_list_price#0 as decimal(8,2))) - promote_precision(cast(ss_ext_discount_amt#0 as decimal(8,2)))), DecimalType(8,2))))])
      :     :     :  :     +- Exchange hashpartitioning(c_customer_id#0, c_first_name#0, c_last_name#0, d_year#0, c_preferred_cust_flag#0, c_birth_country#0, c_login#0, c_email_address#0, 5)
      :     :     :  :        +- *HashAggregate(keys=[c_customer_id#0, c_first_name#0, c_last_name#0, d_year#0, c_preferred_cust_flag#0, c_birth_country#0, c_login#0, c_email_address#0], functions=[partial_sum(UnscaledValue(CheckOverflow((promote_precision(cast(ss_ext_list_price#0 as decimal(8,2))) - promote_precision(cast(ss_ext_discount_amt#0 as decimal(8,2)))), DecimalType(8,2))))])
      :     :     :  :           +- *Project [d_year#0, c_first_name#0, c_login#0, c_last_name#0, ss_ext_list_price#0, ss_ext_discount_amt#0, c_email_address#0, c_customer_id#0, c_preferred_cust_flag#0, c_birth_country#0]
      :     :     :  :              +- *BroadcastHashJoin [ss_sold_date_sk#0], [d_date_sk#0], Inner, BuildRight
      :     :     :  :                 :- *Project [c_first_name#0, c_login#0, c_last_name#0, ss_ext_list_price#0, ss_sold_date_sk#0, ss_ext_discount_amt#0, c_email_address#0, c_customer_id#0, c_preferred_cust_flag#0, c_birth_country#0]
      :     :     :  :                 :  +- *BroadcastHashJoin [c_customer_sk#0], [ss_customer_sk#0], Inner, BuildRight
      :     :     :  :                 :     :- *Project [c_first_name#0, c_login#0, c_last_name#0, c_customer_sk#0, c_email_address#0, c_customer_id#0, c_preferred_cust_flag#0, c_birth_country#0]
      :     :     :  :                 :     :  +- *Filter (isnotnull(c_customer_id#0) && isnotnull(c_customer_sk#0))
      :     :     :  :                 :     :     +- *FileScan parquet default.customer[c_customer_sk#0,c_customer_id#0,c_first_name#0,c_last_name#0,c_preferred_cust_flag#0,c_birth_country#0,c_login#0,c_email_address#0] Batched: true, Format: Parquet, Location: InMemoryFileIndex[<PATH>,c_preferred_...
      :     :     :  :                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[1, int, true] as bigint)))
      :     :     :  :                 :        +- *Project [ss_ext_list_price#0, ss_sold_date_sk#0, ss_ext_discount_amt#0, ss_customer_sk#0]
      :     :     :  :                 :           +- *Filter (isnotnull(ss_customer_sk#0) && isnotnull(ss_sold_date_sk#0))
      :     :     :  :                 :              +- *FileScan parquet default.store_sales[ss_sold_date_sk#0,ss_customer_sk#0,ss_ext_discount_amt#0,ss_ext_list_price#0] Batched: true, Format: Parquet, Location: InMemoryFileIndex[<PATH>,ss_ext_list_price:...
      :     :     :  :                 +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))
      :     :     :  :                    +- *Project [d_date_sk#0, d_year#0]
      :     :     :  :                       +- *Filter ((isnotnull(d_date_sk#0) && (2001 = d_year#0)) && isnotnull(d_year#0))
      :     :     :  :                          +- *FileScan parquet default.date_dim[d_date_sk#0,d_year#0] Batched: true, Format: Parquet, Location: InMemoryFileIndex[<PATH>,d_year:int>
      :     :     :  +- LocalTableScan <empty>, [customer_id#0, year_total#0]
      :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]))
      :     :        +- Union
      :     :           :- *HashAggregate(keys=[c_customer_id#0, c_first_name#0, c_last_name#0, d_year#0, c_preferred_cust_flag#0, c_birth_country#0, c_login#0, c_email_address#0], functions=[sum(UnscaledValue(CheckOverflow((promote_precision(cast(ss_ext_list_price#0 as decimal(8,2))) - promote_precision(cast(ss_ext_discount_amt#0 as decimal(8,2)))), DecimalType(8,2))))])
      :     :           :  +- Exchange hashpartitioning(c_customer_id#0, c_first_name#0, c_last_name#0, d_year#0, c_preferred_cust_flag#0, c_birth_country#0, c_login#0, c_email_address#0, 5)
      :     :           :     +- *HashAggregate(keys=[c_customer_id#0, c_first_name#0, c_last_name#0, d_year#0, c_preferred_cust_flag#0, c_birth_country#0, c_login#0, c_email_address#0], functions=[partial_sum(UnscaledValue(CheckOverflow((promote_precision(cast(ss_ext_list_price#0 as decimal(8,2))) - promote_precision(cast(ss_ext_discount_amt#0 as decimal(8,2)))), DecimalType(8,2))))])
      :     :           :        +- *Project [d_year#0, c_first_name#0, c_login#0, c_last_name#0, ss_ext_list_price#0, ss_ext_discount_amt#0, c_email_address#0, c_customer_id#0, c_preferred_cust_flag#0, c_birth_country#0]
      :     :           :           +- *BroadcastHashJoin [ss_sold_date_sk#0], [d_date_sk#0], Inner, BuildRight
      :     :           :              :- *Project [c_first_name#0, c_login#0, c_last_name#0, ss_ext_list_price#0, ss_sold_date_sk#0, ss_ext_discount_amt#0, c_email_address#0, c_customer_id#0, c_preferred_cust_flag#0, c_birth_country#0]
      :     :           :              :  +- *BroadcastHashJoin [c_customer_sk#0], [ss_customer_sk#0], Inner, BuildRight
      :     :           :              :     :- *Project [c_first_name#0, c_login#0, c_last_name#0, c_customer_sk#0, c_email_address#0, c_customer_id#0, c_preferred_cust_flag#0, c_birth_country#0]
      :     :           :              :     :  +- *Filter (isnotnull(c_customer_id#0) && isnotnull(c_customer_sk#0))
      :     :           :              :     :     +- *FileScan parquet default.customer[c_customer_sk#0,c_customer_id#0,c_first_name#0,c_last_name#0,c_preferred_cust_flag#0,c_birth_country#0,c_login#0,c_email_address#0] Batched: true, Format: Parquet, Location: InMemoryFileIndex[<PATH>,c_preferred_...
      :     :           :              :     +- ReusedExchange [ss_sold_date_sk#0, ss_customer_sk#0, ss_ext_discount_amt#0, ss_ext_list_price#0], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[1, int, true] as bigint)))
      :     :           :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))
      :     :           :                 +- *Project [d_date_sk#0, d_year#0]
      :     :           :                    +- *Filter ((isnotnull(d_date_sk#0) && isnotnull(d_year#0)) && (2002 = d_year#0))
      :     :           :                       +- *FileScan parquet default.date_dim[d_date_sk#0,d_year#0] Batched: true, Format: Parquet, Location: InMemoryFileIndex[<PATH>,d_year:int>
      :     :           +- LocalTableScan <empty>, [customer_id#0, customer_preferred_cust_flag#0, year_total#0]
      :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]))
      :        +- Union
      :           :- LocalTableScan <empty>, [customer_id#0, year_total#0]
      :           +- *Filter (isnotnull(year_total#0) && (0.00 < year_total#0))
      :              +- *HashAggregate(keys=[c_customer_id#0, c_first_name#0, c_last_name#0, c_preferred_cust_flag#0, c_birth_country#0, c_login#0, c_email_address#0, d_year#0], functions=[sum(UnscaledValue(CheckOverflow((promote_precision(cast(ws_ext_list_price#0 as decimal(8,2))) - promote_precision(cast(ws_ext_discount_amt#0 as decimal(8,2)))), DecimalType(8,2))))])
      :                 +- Exchange hashpartitioning(c_customer_id#0, c_first_name#0, c_last_name#0, c_preferred_cust_flag#0, c_birth_country#0, c_login#0, c_email_address#0, d_year#0, 5)
      :                    +- *HashAggregate(keys=[c_customer_id#0, c_first_name#0, c_last_name#0, c_preferred_cust_flag#0, c_birth_country#0, c_login#0, c_email_address#0, d_year#0], functions=[partial_sum(UnscaledValue(CheckOverflow((promote_precision(cast(ws_ext_list_price#0 as decimal(8,2))) - promote_precision(cast(ws_ext_discount_amt#0 as decimal(8,2)))), DecimalType(8,2))))])
      :                       +- *Project [d_year#0, c_first_name#0, c_login#0, ws_ext_discount_amt#0, c_last_name#0, c_email_address#0, c_customer_id#0, ws_ext_list_price#0, c_preferred_cust_flag#0, c_birth_country#0]
      :                          +- *BroadcastHashJoin [ws_sold_date_sk#0], [d_date_sk#0], Inner, BuildRight
      :                             :- *Project [c_first_name#0, c_login#0, ws_ext_discount_amt#0, ws_sold_date_sk#0, c_last_name#0, c_email_address#0, c_customer_id#0, ws_ext_list_price#0, c_preferred_cust_flag#0, c_birth_country#0]
      :                             :  +- *BroadcastHashJoin [c_customer_sk#0], [ws_bill_customer_sk#0], Inner, BuildRight
      :                             :     :- *Project [c_first_name#0, c_login#0, c_last_name#0, c_customer_sk#0, c_email_address#0, c_customer_id#0, c_preferred_cust_flag#0, c_birth_country#0]
      :                             :     :  +- *Filter (isnotnull(c_customer_id#0) && isnotnull(c_customer_sk#0))
      :                             :     :     +- *FileScan parquet default.customer[c_customer_sk#0,c_customer_id#0,c_first_name#0,c_last_name#0,c_preferred_cust_flag#0,c_birth_country#0,c_login#0,c_email_address#0] Batched: true, Format: Parquet, Location: InMemoryFileIndex[<PATH>,c_preferred_...
      :                             :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[1, int, true] as bigint)))
      :                             :        +- *Project [ws_bill_customer_sk#0, ws_ext_discount_amt#0, ws_sold_date_sk#0, ws_ext_list_price#0]
      :                             :           +- *Filter (isnotnull(ws_sold_date_sk#0) && isnotnull(ws_bill_customer_sk#0))
      :                             :              +- *FileScan parquet default.web_sales[ws_sold_date_sk#0,ws_bill_customer_sk#0,ws_ext_discount_amt#0,ws_ext_list_price#0] Batched: true, Format: Parquet, Location: InMemoryFileIndex[<PATH>,ws_ext_list_p...
      :                             +- ReusedExchange [d_date_sk#0, d_year#0], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))
      +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]))
         +- Union
            :- LocalTableScan <empty>, [customer_id#0, year_total#0]
            +- *HashAggregate(keys=[c_customer_id#0, c_first_name#0, c_last_name#0, c_preferred_cust_flag#0, c_birth_country#0, c_login#0, c_email_address#0, d_year#0], functions=[sum(UnscaledValue(CheckOverflow((promote_precision(cast(ws_ext_list_price#0 as decimal(8,2))) - promote_precision(cast(ws_ext_discount_amt#0 as decimal(8,2)))), DecimalType(8,2))))])
               +- Exchange hashpartitioning(c_customer_id#0, c_first_name#0, c_last_name#0, c_preferred_cust_flag#0, c_birth_country#0, c_login#0, c_email_address#0, d_year#0, 5)
                  +- *HashAggregate(keys=[c_customer_id#0, c_first_name#0, c_last_name#0, c_preferred_cust_flag#0, c_birth_country#0, c_login#0, c_email_address#0, d_year#0], functions=[partial_sum(UnscaledValue(CheckOverflow((promote_precision(cast(ws_ext_list_price#0 as decimal(8,2))) - promote_precision(cast(ws_ext_discount_amt#0 as decimal(8,2)))), DecimalType(8,2))))])
                     +- *Project [d_year#0, c_first_name#0, c_login#0, ws_ext_discount_amt#0, c_last_name#0, c_email_address#0, c_customer_id#0, ws_ext_list_price#0, c_preferred_cust_flag#0, c_birth_country#0]
                        +- *BroadcastHashJoin [ws_sold_date_sk#0], [d_date_sk#0], Inner, BuildRight
                           :- *Project [c_first_name#0, c_login#0, ws_ext_discount_amt#0, ws_sold_date_sk#0, c_last_name#0, c_email_address#0, c_customer_id#0, ws_ext_list_price#0, c_preferred_cust_flag#0, c_birth_country#0]
                           :  +- *BroadcastHashJoin [c_customer_sk#0], [ws_bill_customer_sk#0], Inner, BuildRight
                           :     :- *Project [c_first_name#0, c_login#0, c_last_name#0, c_customer_sk#0, c_email_address#0, c_customer_id#0, c_preferred_cust_flag#0, c_birth_country#0]
                           :     :  +- *Filter (isnotnull(c_customer_id#0) && isnotnull(c_customer_sk#0))
                           :     :     +- *FileScan parquet default.customer[c_customer_sk#0,c_customer_id#0,c_first_name#0,c_last_name#0,c_preferred_cust_flag#0,c_birth_country#0,c_login#0,c_email_address#0] Batched: true, Format: Parquet, Location: InMemoryFileIndex[<PATH>,c_preferred_...
                           :     +- ReusedExchange [ws_sold_date_sk#0, ws_bill_customer_sk#0, ws_ext_discount_amt#0, ws_ext_list_price#0], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[1, int, true] as bigint)))
                           +- ReusedExchange [d_date_sk#0, d_year#0], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))
